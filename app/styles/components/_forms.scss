/* ==========================================================================
   SINESE Portal - Form Controls
   Système de formulaires moderne, sobre et accessible
   ========================================================================== */

// =============================================================================
// LABELS
// =============================================================================

label {
  font-weight: 600;
  color: $primary;
  font-size: 0.95rem;
  margin-bottom: 0.5rem;
  display: block;
  transition: $transition-smooth;

  &.small {
    font-weight: 500;
    font-size: 0.8rem;
    color: $text-muted;
  }

  &:hover {
    color: $primary-dark;
  }
}

// =============================================================================
// TEXT INPUTS, EMAIL, PASSWORD, SEARCH, NUMBER, ETC.
// =============================================================================

.form-control {
  border: 1px solid #d1d5db;
  border-radius: $border-radius-sm;
  font-size: 0.95rem;
  background-color: #ffffff;
  color: #1f2937;
  transition: $transition-smooth;
  font-family: $font-family-sans-serif;

  // Placeholder text
  &::placeholder {
    color: $placeholder-color;
    opacity: 0.8;
  }

  // Hover state
  &:not(:focus):hover {
    border-color: #9ca3af;
    background-color: #fafbfc;
  }

  // Focus state
  &:focus {
    outline: none;
    border-color: $primary-dark;
    background-color: #ffffff;
    box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
  }

  // Disabled state
  &:disabled {
    background-color: #f3f4f6;
    color: #9ca3af;
    border-color: #e5e7eb;
    cursor: not-allowed;
    opacity: 0.65;
  }

  // Readonly state
  &[readonly] {
    background-color: #f9fafb;
    color: #6b7280;
    cursor: not-allowed;
    border-color: #d1d5db;
  }

  // Success state
  &.is-valid {
    border-color: $success;
    padding-right: calc(1rem + 1.5rem);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23059669' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375rem + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);

    &:focus {
      border-color: $success;
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
    }
  }

  // Error state
  &.is-invalid {
    border-color: $secondary;
    padding-right: calc(1rem + 1.5rem);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='12 12 24 24'%3e%3ccircle cx='24' cy='24' r='12' fill='none' stroke='%23e74c5a' stroke-width='2'/%3e%3cline x1='24' y1='19' x2='24' y2='29' stroke='%23e74c5a' stroke-width='2'/%3e%3ccircle cx='24' cy='32' r='1' fill='%23e74c5a'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375rem + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);

    &:focus {
      border-color: $secondary;
      box-shadow: 0 0 0 3px rgba(231, 76, 90, 0.1);
    }
  }
}

// =============================================================================
// TEXTAREA
// =============================================================================

textarea.form-control {
  min-height: 120px;
  resize: vertical;
  max-height: 400px;

  &:focus {
    border-color: $primary-dark;
    box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
  }

  &.is-valid:focus {
    box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
  }

  &.is-invalid:focus {
    box-shadow: 0 0 0 3px rgba(231, 76, 90, 0.1);
  }
}

// =============================================================================
// SELECT (FORM-SELECT)
// =============================================================================

.form-select {
  border: 1px solid #d1d5db;
  border-radius: $border-radius-sm;
  padding: 0.75rem 2.5rem 0.75rem 1rem;
  font-size: 0.95rem;
  background-color: #ffffff;
  color: #1f2937;
  transition: $transition-smooth;
  font-family: $font-family-sans-serif;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%231e3a8a' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 16px 12px;

  &:hover,
  &:focus {
    border-color: $primary-dark;
    background-color: $light;
  }

  // Disabled state
  &:disabled {
    background-color: #f3f4f6;
    color: #9ca3af;
    border-color: #e5e7eb;
    cursor: not-allowed;
    opacity: 0.65;
  }

  // Success state
  &.is-valid {
    border-color: $success;

    &:focus {
      border-color: $success;
      box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
    }
  }

  // Error state
  &.is-invalid {
    border-color: $secondary;

    &:focus {
      border-color: $secondary;
      box-shadow: 0 0 0 3px rgba(231, 76, 90, 0.1);
    }
  }

  // Option styling
  // Note: Les states :hover et :focus sur les options ne fonctionnent pas
  // de manière fiable sur les navigateurs (limitation native des éléments <select>)
  option {
    background-color: #ffffff;
    color: #1f2937;
    padding: 0.5rem;
  }

  // Pour un select stylisé avec hover effects, utiliser React Select à la place
}

// =============================================================================
// INPUT GROUPS
// =============================================================================

.input-group {
  .input-group-text {
    background-color: #f9fafb;
    border: 1px solid #d1d5db;
    color: #6b7280;
    border-radius: $border-radius-sm;
    padding: 0.75rem 1rem;
    transition: $transition-smooth;

    svg {
      opacity: 0.7;
      width: 18px;
      height: 18px;
    }
  }

  .form-control {
    border-radius: $border-radius-sm;

    &:focus~.input-group-text {
      border-color: $primary-dark;
      background-color: #ffffff;
    }
  }

  // Ensure proper radius for first and last children
  > :first-child {
    &:not(:last-child) {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
    }
  }

  > :last-child {
    &:not(:first-child) {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
  }
}

// =============================================================================
// FORM CHECKS (CHECKBOXES & RADIOS)
// =============================================================================

.form-check {
  margin-bottom: 1rem;
  display: flex;
  gap: 0.75rem;

  &:last-child {
    margin-bottom: 0;
  }
}

.form-check-input {
  width: 1.25rem;
  height: 1.25rem;
  margin-top: 0.15rem;
  border: 2px solid #d1d5db;
  border-radius: 0.35rem;
  background-color: #ffffff;
  cursor: pointer;
  transition: $transition-smooth;
  flex-shrink: 0;

  // Hover state
  &:not(:checked):not(:disabled):hover {
    border-color: #9ca3af;
    background-color: #f9fafb;
  }

  // Focus state
  &:focus {
    outline: none;
    border-color: $primary-dark;
    box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
  }

  // Checked state
  &:checked {
    background-color: $primary-dark;
    border-color: $primary-dark;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3cpath fill='none' stroke='white' stroke-linecap='round' stroke-linejoin='round' stroke-width='3' d='M6 10l3 3 5-5'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: center;
    background-size: 100% 100%;
  }

  // Disabled state
  &:disabled {
    background-color: #e5e7eb;
    border-color: #d1d5db;
    cursor: not-allowed;
    opacity: 0.65;
  }

  &:checked:disabled {
    background-color: #9ca3af;
    border-color: #9ca3af;
  }

  // Indeterminate state (for checkboxes)
  &:indeterminate {
    background-color: $primary-dark;
    border-color: $primary-dark;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3cline x1='5' y1='10' x2='15' y2='10' stroke='white' stroke-width='3' stroke-linecap='round'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: center;
    background-size: 100% 100%;
  }
}

// Radio button specific styling
input[type="radio"].form-check-input {
  border-radius: 50%;

  &:checked {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3ccircle cx='10' cy='10' r='5' fill='white'/%3e%3c/svg%3e");
  }
}

.form-check-label {
  color: #1f2937;
  font-size: 0.95rem;
  line-height: 1.5;
  cursor: pointer;
  user-select: none;
  transition: $transition-smooth;

  &:hover {
    color: $primary-dark;
  }
}

.form-check-input:disabled~.form-check-label {
  color: #9ca3af;
  cursor: not-allowed;
  opacity: 0.65;
}

// =============================================================================
// FORM TEXT (HELPER TEXT)
// =============================================================================

.form-text {
  font-size: 0.85rem;
  color: #6b7280;
  margin-top: 0.5rem;
  display: block;
}

.invalid-feedback,
.valid-feedback {
  font-size: 0.85rem;
  display: block;
  margin-top: 0.5rem;
  animation: slideIn 0.2s ease-out;
}

.invalid-feedback {
  color: $secondary;
}

.valid-feedback {
  color: $success;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-4px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// =============================================================================
// FORM GROUP SPACING
// =============================================================================

.form-group {
  margin-bottom: 1.75rem;

  &:last-child {
    margin-bottom: 0;
  }

  // Nested form groups
  .form-group {
    margin-bottom: 1rem;
  }
}

// =============================================================================
// FLOATING LABELS (OPTIONAL - MODERN APPROACH)
// =============================================================================

.form-floating {

  >.form-control,
  >.form-select {
    height: calc(3.5rem + 2px);
    padding: 1rem 0.75rem;
  }

  >label {
    color: $text-muted;
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    padding: 1rem 0.75rem;
    pointer-events: none;
    border: 1px solid transparent;
    transform-origin: 0 0;
    transition: opacity 0.1s ease-in-out, transform 0.1s ease-in-out;
  }

  >.form-control:focus~label,
  >.form-control:not(:placeholder-shown)~label,
  >.form-select~label {
    opacity: 0.65;
    transform: scale(0.85) translateY(-0.5rem) translateX(0.15rem);
  }
}

// =============================================================================
// FORM ROW (HORIZONTAL LAYOUT)
// =============================================================================

.form-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;

  >* {
    flex: 1;
    min-width: 200px;

    @media (max-width: 576px) {
      flex: 1 0 100%;
      min-width: unset;
    }
  }
}